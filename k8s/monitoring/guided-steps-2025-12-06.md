# ЁЯУК Kubernetes Monitoring Deployment Guide (2025-12-06)

ржПржЗ ржЧрж╛ржЗржбржЯрж┐ ржЕржирзБрж╕рж░ржг ржХрж░рзЗ ржЖржкржирж┐ Kubernetes ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗ **Monitoring System (Prometheus)** рж╕рзЗржЯржЖржк ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред ржЖржорж░рж╛ ржЦрзБржм рж╕рж╣ржЬржнрж╛ржмрзЗ ржзрж╛ржкржЧрзБрж▓рзЛ рж╕рж╛ржЬрж┐рзЯрзЗржЫрж┐ред

## ЁЯПБ ржзрж╛ржк рзз: Namespace рждрзИрж░рж┐ ржХрж░рж╛
ржкрзНрж░ржержорзЗ `monitoring` ржирж╛ржорзЗ ржПржХржЯрж┐ ржЖрж▓рж╛ржжрж╛ ржЬрж╛рзЯржЧрж╛ (namespace) рждрзИрж░рж┐ ржХрж░ржмрзЛ ржпрзЗржЦрж╛ржирзЗ ржЖржорж╛ржжрзЗрж░ ржоржирж┐ржЯрж░рж┐ржВ ржЯрзБрж▓рж╕ржЧрзБрж▓рзЛ ржерж╛ржХржмрзЗред

```bash
kubectl apply -f k8s/monitoring/namespace.yaml
```

## ЁЯФР ржзрж╛ржк рзи: ржкрж╛рж░ржорж┐рж╢ржи рж╕рзЗржЯ ржХрж░рж╛ (RBAC)
Prometheus ржпрж╛рждрзЗ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ рж╕ржм ржЗржиржлрж░ржорзЗрж╢ржи (ржпрзЗржоржи CPU, Memory) рж░рж┐ржб ржХрж░рждрзЗ ржкрж╛рж░рзЗ, рждрж╛рж░ ржЬржирзНржп ржкрж╛рж░ржорж┐рж╢ржи ржжрж┐рждрзЗ рж╣ржмрзЗред

```bash
kubectl apply -f k8s/monitoring/prometheus/rbac.yaml
```

## тЪЩя╕П ржзрж╛ржк рзй: ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржЕрзНржпрж╛ржкрзНрж▓рж╛ржЗ ржХрж░рж╛
Prometheus ржХрж┐ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ ржПржмржВ ржХрзЛржерж╛ ржерзЗржХрзЗ ржбрж╛ржЯрж╛ ржирж┐ржмрзЗ, рж╕рзЗржЯрж╛ рж╕рзЗржЯ ржХрж░рж╛рж░ ржЬржирзНржп ConfigMap рждрзИрж░рж┐ ржХрж░рждрзЗ рж╣ржмрзЗред

```bash
kubectl apply -f k8s/monitoring/prometheus/configmap.yaml
```

## ЁЯЪА ржзрж╛ржк рзк: Prometheus ржЪрж╛рж▓рзБ ржХрж░рж╛
ржПржЦржи ржЖржорж░рж╛ ржорзВрж▓ Prometheus рж╕рж╛рж░рзНржнрж╛рж░ржЯрж┐ ржЪрж╛рж▓рзБ ржХрж░ржмрзЛред

```bash
kubectl apply -f k8s/monitoring/prometheus/deployment.yaml
kubectl apply -f k8s/monitoring/prometheus/service.yaml
```

## ЁЯЦея╕П ржзрж╛ржк рзл: Node Exporter ржЪрж╛рж▓рзБ ржХрж░рж╛
рж╕рж╛рж░рзНржнрж╛рж░рзЗрж░ (Node) ржлрж┐ржЬрж┐ржХрзНржпрж╛рж▓ ржЕржмрж╕рзНржерж╛ (CPU, RAM usage) ржжрзЗржЦрж╛рж░ ржЬржирзНржп Node Exporter ржЪрж╛рж▓рзБ ржХрж░рждрзЗ рж╣ржмрзЗред ржПржЯрж┐ рж╕ржм ржирзЛржбрзЗ ржЕржЯрзЛржорзЗржЯрж┐ржХ ржЪрж╛рж▓рзБ рж╣ржмрзЗред

```bash
kubectl apply -f k8s/monitoring/node-exporter/daemonset.yaml
```

## ЁЯУЭ ржзрж╛ржк рзм: ржЕрзНржпрж╛ржкрж▓рж┐ржХрзЗрж╢ржи ржЖржкржбрзЗржЯ ржХрж░рж╛
ржЖржорж╛ржжрзЗрж░ Frontend ржПржмржВ Backend ржЕрзНржпрж╛ржкрж▓рж┐ржХрзЗрж╢ржирзЗ ржЖржорж░рж╛ ржХрж┐ржЫрзБ ржЪрзЗржЮрзНржЬ ржХрж░рзЗржЫрж┐ ржпрж╛рждрзЗ Prometheus рждрж╛ржжрзЗрж░ ржоржирж┐ржЯрж░ ржХрж░рждрзЗ ржкрж╛рж░рзЗред ржПржЗ ржЪрзЗржЮрзНржЬржЧрзБрж▓рзЛ ржЕрзНржпрж╛ржкрзНрж▓рж╛ржЗ ржХрж░рждрзЗ рж╣ржмрзЗред

```bash
kubectl apply -f k8s/deployments/backend-deployment.yaml
kubectl apply -f k8s/deployments/frontend-deployment.yaml
```

---

## тЬЕ ржнрзЗрж░рж┐ржлрж┐ржХрзЗрж╢ржи (рж╕ржм ржарж┐ржХ ржЖржЫрзЗ ржХрж┐ржирж╛ ржжрзЗржЦрж╛)

рж╕ржм ржарж┐ржХржарж╛ржХ ржЪрж▓ржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржжрзЗржЦрждрзЗ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЯрж┐ ржжрж┐ржи:

```bash
kubectl get pods -n monitoring
```

ржЖржкржирж┐ ржпржжрж┐ ржжрзЗржЦрзЗржи рж╕ржм `Running` ржЕржмрж╕рзНржерж╛рзЯ ржЖржЫрзЗ, рждрж╛рж╣рж▓рзЗ ржмрзБржЭржмрзЗржи рж╕рж╛ржХрж╕рзЗрж╕ржлрзБрж▓! ЁЯОЙ

**Prometheus ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб ржЪрзЗржХ ржХрж░рж╛:**

ржпрзЗрж╣рзЗрждрзБ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ржЯрж┐ ржХрзНрж▓рж╛ржЙржбрзЗ (Private Network-ржП) ржЖржЫрзЗ, рждрж╛ржЗ ржЖржкржирж╛рж░ рж▓рзНржпрж╛ржкржЯржк ржерзЗржХрзЗ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржжрзЗржЦрждрзЗ рж╣рж▓рзЗ ржПржХржЯрж┐ **SSH Tunnel** ржХрж░рждрзЗ рж╣ржмрзЗред

ржЖржкржирж╛рж░ **рж▓рзЛржХрж╛рж▓ ржкрж┐рж╕рж┐рж░ ржЯрж╛рж░рзНржорж┐ржирж╛рж▓рзЗ** (VS Code ржмрж╛ Git Bash) ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржбржЯрж┐ рж░рж╛ржи ржХрж░рзБржи (ржПржЯрж┐ ржЪрж╛рж▓рзБ рж░рж╛ржЦржмрзЗржи):

```bash
ssh -i terraform/simple-k8s/dhakacart-k8s-key.pem -L 9090:10.0.10.87:30090 ubuntu@18.143.117.139 -N
```

ржХржорж╛ржирзНржбржЯрж┐ рж░рж╛ржи ржХрж░рж╛рж░ ржкрж░ ржХрзЛржирзЛ ржЖржЙржЯржкрзБржЯ ржирж╛ ржЖрж╕рж▓рзЗ ржмрзБржЭржмрзЗржи ржХрж╛ржирзЗржХрж╢ржи рж╣рзЯрзЗржЫрзЗред ржЯрж╛рж░рзНржорж┐ржирж╛рж▓ржЯрж┐ ржорж┐ржирж┐ржорж╛ржЗржЬ ржХрж░рзЗ рж░рж╛ржЦрзБржиред

ржПржЦржи ржЖржкржирж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ ржпрж╛ржи: [http://localhost:9090](http://localhost:9090)

---
**ржЕржержмрж╛ (Recommended) ALB Link ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:**

ржЖржорж░рж╛ ржПржЦржи Prometheus ржХрзЗ ржЖржкржирж╛рж░ ржкрж╛ржмрж▓рж┐ржХ рж▓рзЛржб ржмрзНржпрж╛рж▓рзЗржирзНрж╕рж╛рж░рзЗ ржПржХрзНрж╕ржкрзЛржЬ ржХрж░рзЗржЫрж┐ред ржХрзЛржи SSH Tunnel ржЫрж╛рзЬрж╛ржЗ ржЖржкржирж┐ ржирж┐ржЪрзЗрж░ рж▓рж┐ржВржХрзЗ ржмрзНрж░рж╛ржЙржЬ ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржи:

ЁЯСЙ **http://dhakacart-k8s-alb-98601629.ap-southeast-1.elb.amazonaws.com/prometheus/**

(Note: рж▓рж┐ржВржХржЯрж┐ ржХрж╛ржЬ ржХрж░рждрзЗ рзз-рзи ржорж┐ржирж┐ржЯ рж╕ржорзЯ ржирж┐рждрзЗ ржкрж╛рж░рзЗ, ржХрж╛рж░ржг ржирждрзБржи ржкржб ржЪрж╛рж▓рзБ рж╣ржЪрзНржЫрзЗред)

**ржХрж┐ржЫрзБ ржжрж░ржХрж╛рж░рж┐ Query (ржпрж╛ ржЖржкржирж┐ ржЯрзНрж░рж╛ржЗ ржХрж░рждрзЗ ржкрж╛рж░рзЗржи):**

1. **рж╕ржм рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ рж╕рзНржЯрзНржпрж╛ржЯрж╛рж╕ ржЪрзЗржХ ржХрж░рждрзЗ:**
   ```
   up
   ```
   (ржпржжрж┐ Value 1 рж╣рзЯ, рждрж╛рж░ ржорж╛ржирзЗ рж╕ржм ржарж┐ржХ ржЖржЫрзЗред)

2. **ржЖржкржирж╛рж░ ржирзЛржбржЧрзБрж▓рзЛрж░ ржорзЗржорзЛрж░рж┐ ржЪрзЗржХ ржХрж░рждрзЗ (GB рждрзЗ):**
   ```
   node_memory_MemAvailable_bytes / 1024 / 1024 / 1024
   ```

3. **CPU ржмрзНржпржмрж╣рж╛рж░ ржжрзЗржЦрждрзЗ:**
   ```
   100 - (avg by (instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100)
   ```

---
**Grafana ржбрзНржпрж╛рж╢ржмрзЛрж░рзНржб (ржбрж╛ржЯрж╛ ржнрж┐ржЙржЬрзБрзЯрж╛рж▓рж╛ржЗржЬрзЗрж╢ржи):**

Prometheus ржПрж░ ржбрж╛ржЯрж╛ рж╕рзБржирзНржжрж░ ржХрж░рзЗ ржжрзЗржЦрж╛рж░ ржЬржирзНржп ржЖржорж┐ Grafana рж╕рзЗржЯржЖржк ржХрж░рзЗ ржжрж┐рзЯрзЗржЫрж┐ред ржирж┐ржЪрзЗрж░ рж▓рж┐ржВржХрзЗ ржпрж╛ржи:

ЁЯСЙ **http://dhakacart-k8s-alb-98601629.ap-southeast-1.elb.amazonaws.com/grafana/**

*   **Username:** `admin`
*   **Password:** `dhakacart123`

(ржкрзНрж░ржержорзЗ рж▓ржЧржЗржи ржХрж░рж╛рж░ ржкрж░ ржЖржкржирж╛ржХрзЗ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб ржЪрзЗржЮрзНржЬ ржХрж░рждрзЗ ржмрж▓рждрзЗ ржкрж╛рж░рзЗ, ржЖржкржирж┐ `Skip` ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред)

Grafana рждрзЗ рж▓ржЧржЗржи ржХрж░рзЗ:
1.  ржмрж╛ржо ржкрж╛рж╢рзЗрж░ ржорзЗржирзБ ржерзЗржХрзЗ **Dashboards** ржП ржпрж╛ржиред
2.  **New -> Import** ржП ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред
3.  ID ржмржХрзНрж╕рзЗ `315` (Kubernetes Cluster Monitoring) ржмрж╛ `1860` (Node Exporter) рж▓рж┐ржЦрзЗ **Load** ржжрж┐ржиред
4.  Data Source рж╣рж┐рж╕рзЗржмрзЗ `Prometheus` рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзЗ **Import** ржХрж░рзБржиред
![alt text](image.png)
![alt text](image-1.png)
---

## ЁЯУЬ ржзрж╛ржк рзн: Logging ржЪрж╛рж▓рзБ ржХрж░рж╛ (Loki & Promtail)
Monitoring (Metrics) ржПрж░ ржкрж╛рж╢рж╛ржкрж╛рж╢рж┐ Logs ржжрзЗржЦрж╛рж░ ржЬржирзНржп ржЖржорж░рж╛ Loki ржПржмржВ Promtail рж╕рзЗржЯржЖржк ржХрж░ржмрзЛред

```bash
kubectl apply -f k8s/monitoring/loki/configmap.yaml
kubectl apply -f k8s/monitoring/loki/deployment.yaml
kubectl apply -f k8s/monitoring/loki/service.yaml
kubectl apply -f k8s/monitoring/promtail/rbac.yaml
kubectl apply -f k8s/monitoring/promtail/configmap.yaml
kubectl apply -f k8s/monitoring/promtail/daemonset.yaml
```

**Grafana рждрзЗ Logs ржжрзЗржЦрж╛:**
1. Grafana рждрзЗ рж▓ржЧржЗржи ржХрж░рзБржиред
2. ржмрж╛ржо ржкрж╛рж╢рзЗрж░ ржорзЗржирзБ ржерзЗржХрзЗ **Explore** (Compass icon) ржП ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред
3. ржЙржкрж░рзЗ ржмрж╛ржо ржХрзЛржгрзЗрж░ ржбрзНрж░ржкржбрж╛ржЙржи ржерзЗржХрзЗ **Loki** рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржиред
4. **Label filters** ржП `namespace` = `dhakacart` рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзБржиред
5. ржЙржкрж░рзЗ ржбрж╛ржи ржХрзЛржгрзЗ **Run query** ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред ржЖржкржирж┐ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ рж╕ржм рж▓ржЧ ржжрзЗржЦрждрзЗ ржкрж╛ржмрзЗржи!

---
**Note:** ржХрзЛржерж╛ржУ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржЖржорж╛ржХрзЗ ржЬрж╛ржирж╛ржиред рж╢рзБржн ржХрж╛ржоржирж╛! ЁЯЪА
